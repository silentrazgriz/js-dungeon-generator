<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" href="default.css"/>
		<script src="leaf.js"></script>
		<script src="render.js"></script>
		<script src="room.js"></script>
		<script src="random.js"></script>
	</head>
	<body>
		<div class="info">
			<button id="split" onclick="split()">Split!</button>
			<button id="createRoom" onclick="createRoom()">Create Room!</button>
			<button id="refresh" onclick="refresh()">Refresh!</button>
			<div id="iter">Iteration : 0</div>
			<div id="roomCount">RoomCount : 0</div>
		</div>
		<canvas class="map" id="canvas" width="1000" height="600">
		</canvas>
		<script>
			// Main Code
			var canvas = document.getElementById('canvas');
			var render = new Render(canvas.getContext('2d'));
			var random = new Random();
			var rootLeaf;
			var leafs = new Array();
			var iter = 0;

			// Info Component
			var iterText = document.getElementById('iter');
			var roomCountText = document.getElementById('roomCount');
			var splitButton = document.getElementById('split');
			var createRoomButton = document.getElementById('createRoom');
			var refreshButton = document.getElementById('refresh');

			refresh();

			// Function
			// Create halls for each room
			function createHall() {

			}
			// Create room for each last child
			function createRoom() {
				rooms = new Array();
				for (var i = 0; i < leafs.length; i++) {
					if (leafs[i].leftNode == null && leafs[i].rightNode == null) {
						leafs[i].createRoom(0.5, 0.8, random);
					}
				}
				drawAll();
				splitButton.disabled = true;
			}
			// Refresh the BSP
			function refresh() {
				rootLeaf = new Leaf(0, 0, 1000, 600, render.getRandomColor(random));
				leafs = new Array();
				leafs.push(rootLeaf);
				iter = 0;
				drawAll();
				splitButton.disabled = false;
				createRoomButton.disabled = true;
			}
			// Split current last child
			function split() {
				var leafsLength = leafs.length;
				for (var j = 0; j < leafsLength; j++) {
					if (leafs[j].leftNode == null && leafs[j].rightNode == null && leafs[j].split(render, random)) {
						leafs.push(leafs[j].leftNode);
						leafs.push(leafs[j].rightNode);
					}
				}
				iter++;
				createRoomButton.disabled = false;
				drawAll();
			}
			// Draw all child
			function drawAll() {
				var roomCount = 0;
				render.clear(canvas);
				// Draw leafs
				for (var i = 0; i < leafs.length; i++) {
					if (leafs[i].leftNode == null && leafs[i].rightNode == null) {
						leafs[i].draw(render);
						if (leafs[i].room != null) {
							leafs[i].room.draw(render);
							roomCount++;
						}
					}
				}
				iterText.innerHTML = "Iteration : " + iter;
				roomCountText.innerHTML = "Room Count : " + roomCount;
			}
		</script>
	</body>
</html>
